---
tags: [Obsidian, 插件开发]
---

## 动机

Obsidian 作为一个笔记软件，很重要的一个问题就是同步问题，常用的方法是通过 GitHub 进行同步，但是我的笔记中有视频文件，视频文件比较大，不方便上传到 Github，最好将视频上传到服务器，笔记中只有视频的一个链接，那么视频存放在哪呢，那就是 Notion。

## Why Notion

我为什么选择 Notion？

首先我需要排除付费的方案，所以云存储就不可能，Notion 因为给开发者提供了 API，我们很容易的可以访问到在 Notion 中的资源，另外作为学生，可以享受 Pro Plan，我可以上传无限容量的视频，因此很适合存放视频。

## 实现

如果我们直接从 Notion 中复制视频链接，我们发现这个链接是有时效性的，这正是插件要解决的问题，这个插件主要做两件事：

1. 根据 `block_id` 获取相应的链接
2. 更新视频链接

在开发的过程主要遇到的问题就是 CORS 跨域的问题，如果通过 Notion 提供的 SDK 访问，会发现存在跨域问题，无法获取资源，不过这是一个桌面客户端，我们可以直接使用 `Node.js` 的 `https` 模块直接发起请求，没有浏览器的拦截，自然可以拿到数据。

对于更新视频链接，我是监听了文件打开的事件，如果打开了 Markdown，我会试图根据正则表达式搜索是否有带 `data-block-id` 属性的 `video` 标签，如果有就提取 `block-id` 并获取最新的链接，然后更新链接。

```tip
这里有做一个小优化：我会对打开的文件做一次缓存，如果再次打开，则不会发起请求，只有每次第一次打开才会更新。
```

