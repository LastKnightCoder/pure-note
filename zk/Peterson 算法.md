---
title: Peterson 算法
created: 2023/2/12 12:23:33
updated: 2023/2/12 12:23:33
tags: [操作系统, Peterson, 算法, 并发]
---

两线程竞争访问共享资源，需要保证并发安全，Peterson 算法如下。

线程如果需要访问共享资源，首先需要举起一面旗子，表示自己需要访问共享资源，并且贴上对方名字的标签，如果满足以下条件则可访问资源：

 - 只有自己举起旗子，表示没有人竞争，可以直接访问
 - 都举起了旗子，这时看标签是不是自己的，如果贴的是自己的标签，则可以访问，否则等待

线程访问完资源后，需要将自己的旗子放下，这样别的线程才有机会。否则你举着旗子，标签上写的又是你的名字，别的线程永远没有机会。

这个算法初读有个很奇怪的点，就是贴标签时贴的是对方的名字，正是这种谦让的机制，避免了竞争，以往都是先来先进，这就会带来竞争，现在是来了先等着，直到对方贴上你的名字。虽然是贴的是对方的名字，但还是先贴标签的先访问资源。

- A，B 举起旗子
- A 先来，贴上 B 的名字，A 等待
- B 后来，将标签上的名字改为 A，B 等待
- A 看到标签上是自己的名字，访问资源
- A 访问资源完毕，撤下自己的旗子
- 此时只有 B 举起了旗子，B 可以访问资源
- B 访问完资源，撤下自己的旗子